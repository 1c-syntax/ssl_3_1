///////////////////////////////////////////////////////////////////////////////////////////////////////
// Copyright (c) 2019, ООО 1С-Софт
// Все права защищены. Эта программа и сопроводительные материалы предоставляются 
// в соответствии с условиями лицензии Attribution 4.0 International (CC BY 4.0)
// Текст лицензии доступен по ссылке:
// https://creativecommons.org/licenses/by/4.0/legalcode
///////////////////////////////////////////////////////////////////////////////////////////////////////

#Область СлужебныеПроцедурыИФункции

// Устанавливает настройку в параметры резервного копирования. 
// 
// Параметры: 
//	ИмяЭлемента - Строка - имя параметра.
// 	ЗначениеЭлемента - Произвольный тип - значение параметра.
//
Процедура УстановитьЗначениеНастройки(ИмяЭлемента, ЗначениеЭлемента) Экспорт
	
	РезервноеКопированиеИБСервер.УстановитьЗначениеНастройки(ИмяЭлемента, ЗначениеЭлемента);
	
КонецПроцедуры

// Формирует значение ближайшего следующего автоматического резервного копирования в соответствии с расписанием.
//
// Параметры:
//	НачальнаяНастройка - Булево - признак начальной настройки.
//
Функция ДатаСледующегоАвтоматическогоКопирования(ОтложитьРезервноеКопирование = Ложь) Экспорт
	
	Результат = Новый Структура;
	Настройки = РезервноеКопированиеИБСервер.НастройкиРезервногоКопирования();
	
	ТекущаяДата = ТекущаяДатаСеанса();
	
	РасписаниеКопирования = Настройки.РасписаниеКопирования;
	ПериодПовтораВТечениеДня = РасписаниеКопирования.ПериодПовтораВТечениеДня;
	ПериодПовтораДней = РасписаниеКопирования.ПериодПовтораДней;
	
	Если ОтложитьРезервноеКопирование Тогда
		Значение = ТекущаяДата + 60 * 15;
	ИначеЕсли ПериодПовтораВТечениеДня <> 0 Тогда
		Значение = ТекущаяДата + ПериодПовтораВТечениеДня;
	ИначеЕсли ПериодПовтораДней <> 0 Тогда
		Значение = ТекущаяДата + ПериодПовтораДней * 3600 * 24;
	Иначе
		Значение = НачалоДня(КонецДня(ТекущаяДата) + 1);
	КонецЕсли;
	Результат.Вставить("МинимальнаяДатаСледующегоАвтоматическогоРезервногоКопирования", Значение);
	
	ЗаполнитьЗначенияСвойств(Настройки, Результат);
	РезервноеКопированиеИБСервер.УстановитьНастройкиРезервногоКопирования(Настройки);
	
	Возврат Результат;
	
КонецФункции

// Устанавливает дату последнего оповещения пользователя.
//
// Параметры: 
//	ДатаНапоминания - Дата - дата и время последнего оповещения пользователя о необходимости проведения резервного
//	                         копирования.
//
Процедура УстановитьДатуПоследнегоНапоминания(ДатаНапоминания) Экспорт
	
	РезервноеКопированиеИБСервер.УстановитьДатуПоследнегоНапоминания(ДатаНапоминания);
	
КонецПроцедуры

#КонецОбласти
